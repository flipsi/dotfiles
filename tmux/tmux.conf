# This is a configuration file for tmux.

# Author: Philipp Moers <soziflip@gmail.com>


#### PLUGINS ####

# managed by tmux plugin manager (https://github.com/tmux-plugins/tpm)
# which basically works like a vim plugin manager


# follow urls easily
set -g @plugin 'tmux-plugins/tmux-urlview'
set -g @urlview-key 'u'

# yank to system clipboard easily
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @shell_mode 'vi'
set -g @yank_selection 'clipboard' # primary | secondary | clipboard

# select advanced stuff quickly without a mouse
set -g @plugin 'tmux-plugins/tmux-copycat'

# persistent sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'



#### OPTIONS ####

# update window-title
set -g set-titles on

# no delay with escape (e.g. in vim)
set -sg escape-time 0

# scrollback history
set -g history-limit 100000


# window and pane numbers from 1 instead of 0
set -g base-index 1
set -g pane-base-index 1


# handle focus events (for vim)
set -g focus-events on

# update multiple tmux instances
#setw -g monitor-activity on
#set -g visual-activity on


# message bar
set -g display-time 2000
set -g display-panes-time 2000

# status bar
set -g status-interval 10
set -g status-left ''
set -g status-right-length 120
set -g status-right '#{pane_current_path}    [#{pane_width}x#{pane_height}] '
# set -g status-right '#{pane_current_path}    [#{window_index}|#{session_windows}] : [#{pane_index}|#{window_panes}] '
# set -g status-right "#[fg=green][#I:#P #W] {#[bold,fg=cyan]%a %m/%d %H:%M%p#[nobold,fg=default]}"
# set -g status-right "#[fg=yellow]:: %d %b %Y #[fg=green]:: %l:%M %p :: #(date -u | awk '{print $4}')::"

# status bar position
set -g status-position top

# show/hide status bar completely
set -g status on

# terminal title bar
set -g set-titles-string "#I:#P - #W - #T"




#### COLORS ####

set -g default-terminal "screen-256color"

TMUX_COLOUR_ACCENT="colour23"

# statusbar
set-option -g status-bg colour232
set-option -g status-fg colour253
set-option -g status-attr default

# window title colors
set-window-option -g window-status-fg colour247
set-window-option -g window-status-bg default
set-window-option -g window-status-attr dim
set-window-option -g window-status-current-bg $TMUX_COLOUR_ACCENT
set-window-option -g window-status-current-fg colour235
set-window-option -g window-status-current-attr bold

# pane border
set-option -g pane-border-fg        colour241
set-option -g pane-active-border-fg $TMUX_COLOUR_ACCENT

# message text
set-option -g message-bg colour234
set-option -g message-fg $TMUX_COLOUR_ACCENT
set-option -g message-attr bold

# choose window display / highlight in copy mode / ...
setw -g mode-bg $TMUX_COLOUR_ACCENT
setw -g mode-fg colour235

# pane number display
set-option -g display-panes-active-colour $TMUX_COLOUR_ACCENT
set-option -g display-panes-colour $TMUX_COLOUR_ACCENT

# clock
set-window-option -g clock-mode-colour $TMUX_COLOUR_ACCENT






#### KEYBINDINGS ####

unbind space


# use vim keys
set -gw mode-keys vi
set-option -g status-keys emacs


# set tmux prefix
set -g prefix C-Space
set -g prefix2 C-t
# send prefix to remote session
bind-key C-Space send-prefix
bind-key C-t send-prefix


# create new session
bind-key c new-session

# kill this session and attach another
bind-key X confirm-before -p "Kill #S (y/n)?" "run-shell 'tmux switch-client -n \\\; kill-session -t \"\$(tmux display-message -p \"#S\")\"'"


# toggle status bar
bind-key b set status on
bind-key B set status off

# change window
bind-key "#" choose-window
bind-key -T root C-M-"#" choose-window
bind-key -T root C-M-n next-window
bind-key -T root C-M-p previous-window
bind-key space last-window
bind-key -T root M-space last-window

# new window
bind-key -T root C-M-i new-window -c $HOME
bind-key I new-window -c $HOME # tpm overwrites this
bind-key i new-window -c '#{pane_current_path}'

# new window with current pane
bind-key ! break

# split window with new pane
bind-key o split-window -v -c '#{pane_current_path}'
bind-key O split-window -h -c '#{pane_current_path}'
bind-key -T root C-M-o split-window -v -c '#{pane_current_path}' -p 35\; swap-pane -U


# pane selection
bind-key h select-pane -L
bind-key l select-pane -R
bind-key j select-pane -D
bind-key k select-pane -U
# bind-key j select-pane -t :.+
# bind-key k select-pane -t :.-

# pane selection without prefix
bind-key -T root C-M-h select-pane -L
bind-key -T root C-M-l select-pane -R
bind-key -T root C-M-j select-pane -D
bind-key -T root C-M-k select-pane -U

# pane rearrangement
bind-key J select-layout even-vertical
bind-key L select-layout even-horizontal
bind-key H swap-pane -U
bind-key K swap-pane -U
bind-key C-j resize-pane -D 3
bind-key C-k resize-pane -U 3
bind-key C-l resize-pane -R 3
bind-key C-h resize-pane -L 3

# move window/pane to another window
bind-key m command-prompt "move-window -t '%%'"
bind-key M command-prompt -p "move pane to:"  "join-pane -t :'%%'"

# delete pane with x
#bind-key d confirm-before -p "kill-pane #P? (y/n)" kill-pane

# command line mode
bind-key -t vi-edit C-g     cancel
bind-key -t vi-edit C-a     start-of-line
bind-key -t vi-edit C-e     end-of-line
bind-key -t vi-edit M-f     next-word
bind-key -t vi-edit M-b     previous-word
bind-key -t vi-edit C-k     delete-end-of-line
bind-key -t vi-edit M-d     delete-word

# copy mode
# http://jasonwryan.com/blog/2011/06/07/copy-and-paste-in-tmux/
# https://github.com/myfreeweb/dotfiles/blob/master/tmux.conf
bind-key Escape copy-mode # enter copy mode; default [
bind-key M-j    copy-mode # enter copy mode; default [
bind-key M-k    copy-mode # enter copy mode; default [
# bind-key -t vi-copy Escape  cancel # exit copy mode; or hit q # THIS BREAKS TMUX-COPYCAT
bind-key -t vi-copy M-k     page-up
bind-key -t vi-copy M-j     page-down
bind-key -t vi-copy ,       jump-again
bind-key -t vi-copy \;      jump-reverse
bind-key -t vi-copy C-a     start-of-line
bind-key -t vi-copy C-e     end-of-line
bind-key -t vi-copy v       begin-selection # begin visual mode
bind-key -t vi-copy V       select-line # visual line
bind-key -t vi-copy C-v     rectangle-toggle # visual block toggle
#bind-key -t vi-copy y copy-selection # yank
#bind-key -t vi-copy y copy-selection \; run-shell 'tmux show-buffer | xsel -bi && tmux show-buffer | xsel -pi' # yank
#bind-key P paste-buffer # paste; default ]

# YANKING WITH tmux-yank PLUGIN
# PASTING:
bind-key v paste-buffer
bind-key P run-shell 'tmux set-buffer "$(xsel -po)"' \; paste-buffer # paste; default ]
#bind-key P run-shell 'tmux set-buffer "$(xsel -bo)"' \; paste-buffer # paste; default ]

# read and write and delete paste buffer (xsel method)
# https://wiki.archlinux.org/index.php/Tmux#ICCCM_Selection_Integration
# ctrl+shift+v
#bind-key < command-prompt -p "send to tmux:" "run-shell 'tmux set-buffer -- \"$(xsel -o -b)\"'"
#bind-key > command-prompt -p "send to xsel:" "run-shell 'tmux show-buffer | xsel -i -b'"
#bind-key y run-shell 'tmux show-buffer | xsel -bi && tmux show-buffer | xsel -pi'
#bind-key + command-prompt "delete-buffer"




# reload this config file
bind f5 source-file ~/.tmux.conf \; display-message " Config reloaded..".
# reload this config file and install plugins (default key I)
bind f5 run-shell ~/.tmux/plugins/tpm/bindings/install_plugins

# Initialize tmux plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'


