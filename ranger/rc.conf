# This is a configuration file for ranger, a file manager for the console.
# It should be located at ~/.config/ranger/rc.conf (or a symlink should).

# Author: Philipp Moers <soziflip@gmail.com>


#### SETTINGS ####

# my colorscheme
set colorscheme sflea

# columns layout
set column_ratios 3,6,8

# show borders?
set draw_borders true

# show when tasks are running
#draw_progress_bar_in_statusbar true

# preview files and folders
set preview_files true
set preview_directories true

# collapse preview column if there is no preview
set collapse_preview false

# set tmux title to "ranger"?
set update_title true
set update_tmux_title false

# show paths in tabs?
set dirname_in_tabs true

# number of remembered directory changes and size of command history
set max_history_size 1000
set max_console_history_size 90000

# mouse usage for the average user :)
set mouse_enabled true


#### KEYBINDINGS ####

# quit ranger
map <c-d> quit

# reload this config file
map <F5> chain source ~/.config/ranger/rc.conf; eval fm.notify("Config reloaded!")

# move fast
map gj move down=8
map gk move up=8

# scroll fast
map <a-j> scroll 20
map <a-k> scroll -20

# change layout
map zln set column_ratios 3,6,8
map zlg set column_ratios 3,6,6
map zlm set column_ratios 2,9,6
map zlp set column_ratios 1,4,9
map zls set column_ratios 1,9,1

# show hidden files or not
map . toggle_option show_hidden

# (un-)select file
map s  mark_files toggle=True
map us mark_files all=True val=False

# enter dir with return, so:
# move to parent dir
map <backspace>  cd ..
map <backspace2> cd ..

# edit file with vim
map ee open_with vim
map eE shell sudoedit %s
map eS shell sudo vim %s
map eo shell tmux splitw -v 'vim %s';
map eO shell tmux splitw -h 'vim %s';
map eg shell gvim --servername main --remote %s
map eG open_with gvim
map ei shell      bash -c "vim -u <(curl https://raw.githubusercontent.com/sflip/dotfiles/master/vim/vimrc) %s"
map eI shell sudo bash -c "vim -u <(curl https://raw.githubusercontent.com/sflip/dotfiles/master/vim/vimrc) %s"
#map eO eval if os.environ.has_key('TMUX'): fm.execute_console("shell tmux splitw -h 'vim " + fm.thisfile.basename + "'")
map er         shell vim --servername main --remote %s
map eR console shell vim --servername main --remote %s

# open file
map <A-CR>l open_with less
map <A-CR>f shell tail -f %f
map <A-CR>s shell subl --new-window %s
map <A-CR>S shell subl --add %s
map <A-CR>u open_with luakit
map <A-CR>o shell open %s
map ow console open_with %space

# execute file
map <A-CR>x      shell -w ./%f
map <A-CR><A-CR> shell -w ./%f

# open some external tools
map io  shell    open . # open current dir in finder
map if  shell    fish
map ib  shell    bash
map iv  shell         vim
map iV  console shell vim --servername %space
map iu  shell -f open . # open dir in Finder
map it  shell    tig status
map idi shell -w clear; if (diff %c %f); then echo 'Exactly the same, bro!'; fi;
map idv shell    vimdiff %c %f
map idp shell -f diffpdf %c %f
map idu shell -w clear; du -h --max-depth=1 %f
map is  shell -f sxiv *.png *.PNG *.jpg *.JPG *.jpeg *.JPEG
map ip  shell    pdfimages -png %f %f
map ic  shell    bash -c 'sleep 0.3 && cmus-remote --clear && cmus-remote . && cmus-remote --play  && cmus-remote --raw "view 3" && cmus-remote --raw "refresh"' & pkill cmus; cmus
# default keybinding for compatibility
map ii display_file

# execute one shell command
# map ! console shell -pw %space
# open a full shell
map O shell fish

# pack/unpack archive
map ap shell ar -r %f.zip %s
map up shell -pw unar %s

# create ('add') file/directory
map aF console touch %space
map aD console mkdir %space
map af console edit %space
map ad console -p14 eval dirname=""; fm.mkdir(dirname); fm.cd(dirname)
map ae console edit %space
map aE console shell sudoedit %space

# copy/move a file with root permissions
map ps shell sudo cp -r %c ./
map pS shell sudo mv %c ./

# rename a file
map cw console rename%space
map cW console shell sudo mv %f %f
map A rename_append
# substitute spaces with underscores:
# map cs shell rename 's/ /_/g' %s # http://stackoverflow.com/a/1086509/4568748
map cs shell for f in %s; do mv "$f" $(echo "$f" | sed 's/ /_/g'); done
# append/prepend current date ('today'):
map ct shell for f in %s; do mv "$f" $(echo $(date +%%%%F) "$f" | sed 's/\(.\{10\}\)\s\(.*\)\.\(.\{3,4\}\)/\2-\1.\3/'); done
map cT shell for f in %s; do mv "$f" $(echo $(date +%%%%F) "$f" | sed 's/\(.\{10\}\)\s\(.*\)\.\(.\{3,4\}\)/\1-\2.\3/'); done

# create backup copy of file
map yb shell cp -r %f %f.bak
map yB shell sudo cp -r %f %f.bak

# delete file
#map xr console delete
map xr delete
map xt shell rmtrash %s
map xR shell sudo rm -rf %s
map ut shell -w trash-restore

# new tab
map <a-i> tab_new ~
# goto next/previous tab
map <a-n> tab_move 1
map <a-p> tab_move -1

# search, filter and travel
map ö console scout -stl %space
map Ö console scout -st  %space
map ag console shell -w ag %space
map ff console filter %space
map uf filter
map t console travel %space
map T chain cd /; console travel %space

# jump to directory or mark
map gt cd /tmp
map gl cd /var/log
map gm cd /mnt
map gM cd /run/media/sflip
copymap ' ä
copymap ' <a-w>
map ää cd -
map <Space> cd -
map fi         fzf find
map fl console fzf locate %space

# switch to root
map S shell sudo ranger
